#!/bin/bash
#
# Packages mythbox for distribution as an addon zip file.
#
find . -name "*.pyc" | xargs rm -fv
find . -name "*.pyo" | xargs rm -fv

#export rev='1.0RC2'
export rev=$1
echo Packaging script.mythbox.1.0.$rev

rm -rf target
mkdir -p target/script.mythbox
cp -r * target/script.mythbox/
cd target
sed -i "s/version=\"1\.0\.RC2\"/version=\"1\.0\.${rev}\"/g" script.mythbox/addon.xml
 
zip --quiet \
    --recurse-paths \
    script.mythbox.1.0.$rev.zip \
    script.mythbox \
    --exclude="script.mythbox/*.log" \
    --exclude="script.mythbox/*.gz" \
    --exclude="script.mythbox/*.*~" \
    --exclude="script.mythbox/doc/*" \
    --exclude="script.mythbox/trac/*" \
    --exclude="script.mythbox/ondemandconfig.ini" \
    --exclude="script.mythbox/addon/*" \
    --exclude="script.mythbox/mythbox_report.html" \
    --exclude="script.mythbox/bin/*" \
    --exclude="script.mythbox/resources/test/*" \
    --exclude="script.mythbox/resources/itest/*" \
    --exclude="script.mythbox/target/*"
        
echo Done